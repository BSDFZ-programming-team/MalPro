<h1 align="center">MalProüïµÔ∏è -- Malware classification by using assembly files!</h1>
<em><h3 align="center">Train your model & Analyze malwares quickly, easily, accurately!</h3></em>
<p align="center">
<img src=https://img.shields.io/badge/python-3.7+-blue?style=for-the-badge>
<img src=https://img.shields.io/badge/License-Apache2-green?style=for-the-badge>
<img src=https://img.shields.io/badge/State-Developing-red?style=for-the-badge>
<img src=https://img.shields.io/badge/Platform-Windows-orange?style=for-the-badge>
<em><h5 align="center">malware analyzer under python3 and machine learning</h5></em>
<img src=https://files.cnblogs.com/files/blogs/820580/logo.ico?t=1722150186&download=true>

ps: also a project for ‰∏äÊµ∑‰∫§ÈÄöÂ§ßÂ≠¶‰∫∫Â∑•Êô∫ËÉΩËç£Êò∂ÊùØ

> üöß **Currently under developing** üöß
>
> Malpro is currently in active development and not usable yet.For now, we only support 9 types of malware families and classifying by using assembly files directly, we will complete more features in the future.

# Background & Our Ideas

## What does our project do?

There are many products that use raw PE(.exe) file to classify malwares by using machine learning and/or extracting PE features. But instead, We are using assembly file of the raw PE file (generated by IDA) to classify it. 

Our project can classify 79 types of malware behaviour.

**And for the Beta version, only 9 types is supported, we are still searching for a way to train a better model that could classify 79 types of malware.**

## Our ideas

### The background of our idea

When we are doing our research, we have noticed a bunch of project using cnn(or malconv, random forest, etc.) to classify the malware. 

Then, we saw a competition held by Microsoft (https://www.kaggle.com/competitions/malware-classification) that use .asm file to classify 9 different types of malware family. 

So could we classify more types of it? We have learned about the blogs, articles and interviews published by the champions of this competition. Finally, we decided that classifying by assembly file would be a good idea.

### Why assembly file?

Features in assembly file are easier to be learned by machines than raw PE file.

We try to prove this as rigorous as possible, but because of the lack of time and cpu(I'm dead serious), we could only say that when only you got only 6000s and one cpu, training random forest models by using assembly file is better than PE file.

If you are interested in it, see [blog](#blog).

### Advantage of assembly files

The powerful features in assembly files are: 

	* .asm image features
	* opgram-ncode features
	
We train our random forest model by using these two features

by the way, we use 1500px for the .asm image features and n=3 for the opgram-ncode features in this project.

# Project usage

there is a model trained by us in the project file (model/model.pt), so you can predict the malware without training on your own

## requirments

### install python libraries

*TIPS: We recommend python 3.9 for this*

```
pip -r requirments.txt
```

*TIPS: we recommend you to create a new virtual environment for this project because it depends on some libraries in old version*

### install IDA pro

install IDA pro (7.x) from [here](https://hex-rays.com/IDA-pro/)

TODO: Use IDA to turn PE files into assembly files.

## Use

### predict

```
python server.py
```

It will run a web server on your host(port 7777) as the frontend of our project, open it and upload your PE file, you will see a result like this.

**We are now developing features of turning the uploaded PE file to asm by using IDA pro. so for now this server could only give out NON-VIRUS result, that is, we only support assembly file now.** 
**if you want to predict your assembly file, use main.py.**

![](https://files.cnblogs.com/files/blogs/820580/example.ico?t=1722150163&download=true)

download the analyze details if you want. 

### train

**download .asm dataset with labels**

Because of the copyright issues, we can't publish the dataset of 79 different behaviour of malwares, but instead, you can download the dataset of [kaggle](https://www.kaggle.com/competitions/malware-classification) which contains 9 types of malware famlies

**create /train folder and TrainLabels.csv**

copy your data set to /train and your label file to TrainLabels.csv(same label file format in the kaggle challenge)

*TIPS: if your train set is a subset of your label file(rename it to trainLabels_all.csv), use utils/convert.py to fix it.*

**Create a /subtrain folder**

`python randomsubset.py`

*TIPS: if you really don't know what to do, copy your /train and rename it to /subtrain, then run the script above.*

**Run main.py to train the model**

`python main.py`

it will show a menu like this

![](https://files.cnblogs.com/files/blogs/820580/example2.ico?t=1722150155&download=true)

you can train your model in this script

# Contributors

### Project by:  

WeiLin Du([LamentXU](https://www.cnblogs.com/LAMENTXU))  
QiXun Zhong([wcnmd-txt](https://github.com/wcnmd-txt))  
YiFan He([0D00-O721](https://github.com/0D00-O721))  

### guided by:  

XiaoBin Peng([handsongPeng](https://github.com/handsongPeng))  

# Reports
Please send bug reports and feature requests through github issue tracker. Malpro is currently under development now and it's open to any constructive suggestions.

# License
The Malpro project is released under apache2 license.

# Blog

https://www.cnblogs.com/LAMENTXU/articles/18306874